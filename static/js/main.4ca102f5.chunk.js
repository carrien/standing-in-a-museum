(this.webpackJsonpsitting=this.webpackJsonpsitting||[]).push([[0],{11:function(t,e,n){},12:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),i=n(3),o=n.n(i),u=(n(11),n(4)),c=n(1),s=n(5),f=function(t,e){var n=t.map((function(t){return{started:!1,finished:!1,target:t}}));!function t(e,n){var r=e.filter((function(t){return!t.started}));r.length&&(r[0].started=!0,n(e),fetch(r[0].target.url).then((function(t){return t.arrayBuffer()})).then((function(a){r[0].finished=!0,r[0].target.arrayBuffer=a,n(Object(s.a)(e)),t(e,n)})))}(n,e);return{status:function(){return n}}},l=Array(120).fill(0).map((function(t,e){return(e%10).toString().padStart(2,"0")})).map((function(t){return"sitting/sitting.".concat(t,".mp3")})).map((function(t,e){return{url:t,durationMs:0,gallery:"coat-closet",iteration:e,sequence:0,arrayBuffer:null}}));function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(n,!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d=.1,m=.2;function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(n,!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h=new(window.AudioContext||window.webkitAudioContext),O={progress:[],audioContextStatus:h.state,playbackStatus:{}},v=function(t,e){switch(e.type){case"beginPlayback":return b({},t,{audioContextStatus:h.state});case"downloadStatus":return b({},t,{progress:e.progress});case"playbackStatus":return b({},t,{playbackStatus:e.status});default:return t}},w=function(){var t=Object(r.useReducer)(v,O),e=Object(u.a)(t,2),n=e[0],i=e[1],o=n.progress.filter((function(t){return t.finished})).length,c=n.progress.length,s=Object(r.useRef)((function(t){}));Object(r.useEffect)((function(){console.log("DL",l.length),f(l,(function(t){return i({type:"downloadStatus",progress:t})}))}),[]),Object(r.useEffect)((function(){if(!(n.progress.filter((function(t){return t.finished})).length<l.length)){var t=n.progress.map((function(t){return t.target})),e=function(t,e,n){var r=1+Math.max.apply(null,e.map((function(t){return t.iteration}))),a=[],i=function(e){var n=t.createBufferSource();n.buffer=e.audioBuffer;var r=t.createGain();return n.connect(r),r.connect(t.destination),r.gain.setValueAtTime(1e-8,e.startTime),r.gain.exponentialRampToValueAtTime(.999,e.startTime+d),n.start(e.startTime,e.offset),{bufferDuration:e.audioBuffer.duration,logicalStartTime:e.startTime,media:e.segment,node:n,gainNode:r}},o=null,u=null,c=function(n){u&&u.node.disconnect();var o,c=a.slice(-1)[0],s=c.logicalStartTime+c.bufferDuration,f=e.filter((o=c.media,function(t){var e=(o.iteration+1)%r;return t.iteration===e&&t.gallery===o.gallery}))[0],l=f.arrayBuffer;l=l.slice(0,l.byteLength),t.decodeAudioData(l,(function(t){var e=i({segment:f,startTime:s,offset:0,audioBuffer:t});u=e;var n=a;c.node.addEventListener("ended",(function(){n===a&&(a=[e],u=null)}))}),(function(t){console.log("Decode err",t)}))};return setInterval((function(){if(o&&0!==a.length){var e=a.slice(-1)[0].media;e.iteration!==o.iteration&&(o={gallery:o.gallery,iteration:e.iteration,offset:0},c()),n(p({},o,{offset:t.currentTime-a[0].logicalStartTime}))}}),1e3*m),{dispatch:function(n){if("change-iteration"===n.type&&(!o||o.iteration!==n.iteration)){var r=e.filter((function(t){return t.iteration===n.iteration}))[0],u=r.arrayBuffer;u=u.slice(0,u.byteLength),t.decodeAudioData(u,(function(e){var u=a.length?t.currentTime-a.slice(-1)[0].logicalStartTime:0,s=t.currentTime+.1,f=i({segment:r,startTime:s,offset:u,audioBuffer:e});a.forEach((function(t){t.gainNode.gain.setValueAtTime(.9999,s),t.gainNode.gain.exponentialRampToValueAtTime(1e-5,s+3*d)})),a=[{node:f.node,gainNode:f.gainNode,logicalStartTime:t.currentTime-u,bufferDuration:e.duration,media:r}];var l={iteration:n.iteration,gallery:"first-floor"};c(),o=p({},l,{offset:0})}),(function(t){console.log("Decode err",t)}))}}}}(h,t,(function(t){return i({type:"playbackStatus",status:t})}));s.current=e.dispatch}}),[n.progress]);return a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("button",{onClick:function(){return console.log("Starting audio",h),void h.resume().then((function(){i({type:"beginPlayback"})}))}},"Begin Playback"),"running"===n.audioContextStatus&&l.map((function(t){return a.a.createElement("button",{key:t.iteration,onClick:function(){return s.current({type:"change-iteration",iteration:t.iteration})}},t.iteration)})),a.a.createElement("pre",null,o," of ",c," files loaded.",n.audioContextStatus),a.a.createElement("br",null),a.a.createElement("pre",null,JSON.stringify(n.playbackStatus,null,2))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},6:function(t,e,n){t.exports=n(12)}},[[6,1,2]]]);
//# sourceMappingURL=main.4ca102f5.chunk.js.map