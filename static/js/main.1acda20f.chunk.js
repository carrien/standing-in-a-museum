(this.webpackJsonpsitting=this.webpackJsonpsitting||[]).push([[0],[,,,,,,function(t,e,n){t.exports=n(13)},,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),i=n(3),o=n.n(i),c=(n(11),n(4)),u=n(1),s=n(5),l=function(t,e,n){var r=t.map((function(t){return{started:!1,finished:!1,target:t}}));Array(e).fill(0).forEach((function(){return function t(e,n){var r=e.filter((function(t){return!t.started}));r.length&&(r[0].started=!0,n(e),fetch(r[0].target.url).then((function(t){return t.arrayBuffer()})).then((function(a){r[0].finished=!0,r[0].target.arrayBuffer=a,n(Object(s.a)(e)),t(e,n)})))}(r,n)}));return{status:function(){return r}}},f=(n(12),Array(9).fill(0).map((function(t,e){return e.toString().padStart(2,"0")})).map((function(t){return"sitting/sitting.".concat(t,".mp3")})).map((function(t,e){return{url:t,durationMs:0,gallery:"coat-closet",iteration:e,sequence:0,arrayBuffer:null}})));function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(n,!0).forEach((function(e){Object(u.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d=.1,m=.2;function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(n,!0).forEach((function(e){Object(u.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h=new(window.AudioContext||window.webkitAudioContext),O={progress:[],audioContextStatus:h.state,playbackStatus:{}},v=function(t,e){switch(e.type){case"requestIteration":return b({},t,{requestedIteration:e.iteration});case"beginPlayback":return b({},t,{audioContextStatus:h.state});case"downloadStatus":return b({},t,{progress:e.progress});case"playbackStatus":return b({},t,{playbackStatus:e.status});default:return t}},w=function(){var t=Object(r.useReducer)(v,O),e=Object(c.a)(t,2),n=e[0],i=e[1],o=n.progress.filter((function(t){return t.finished})).length,u=n.progress.length,s=Object(r.useRef)((function(t){}));Object(r.useEffect)((function(){console.log("DL",f.length),l(f,3,(function(t){return i({type:"downloadStatus",progress:t})}))}),[]),Object(r.useEffect)((function(){if(!(n.progress.filter((function(t){return t.finished})).length<f.length)){var t=n.progress.map((function(t){return t.target})),e=function(t,e,n){var r=1+Math.max.apply(null,e.map((function(t){return t.iteration}))),a=[],i=function(e){var n=t.createBufferSource();n.buffer=e.audioBuffer;var r=t.createGain();return n.connect(r),r.connect(t.destination),r.gain.setValueAtTime(1e-8,e.startTime),r.gain.exponentialRampToValueAtTime(.999,e.startTime+d),n.start(e.startTime,e.offset),{bufferDuration:e.audioBuffer.duration,logicalStartTime:e.startTime,media:e.segment,node:n,gainNode:r}},o=null,c=null,u=function(n){c&&c.node.disconnect();var o,u=a.slice(-1)[0],s=u.logicalStartTime+u.bufferDuration,l=e.filter((o=u.media,function(t){var e=(o.iteration+1)%r;return t.iteration===e&&t.gallery===o.gallery}))[0],f=l.arrayBuffer;f=f.slice(0,f.byteLength),t.decodeAudioData(f,(function(t){var e=i({segment:l,startTime:s,offset:0,audioBuffer:t});c=e;var n=a;u.node.addEventListener("ended",(function(){n===a&&(a=[e],c=null)}))}),(function(t){console.log("Decode err",t)}))};return setInterval((function(){if(o&&0!==a.length){var e=a.slice(-1)[0].media;e.iteration!==o.iteration&&(o={gallery:o.gallery,iteration:e.iteration,offset:0},u()),n(p({},o,{offset:t.currentTime-a[0].logicalStartTime}))}}),1e3*m),{dispatch:function(n){if("change-iteration"===n.type&&(!o||o.iteration!==n.iteration)){var r=e.filter((function(t){return t.iteration===n.iteration}))[0],c=r.arrayBuffer;c=c.slice(0,c.byteLength),t.decodeAudioData(c,(function(e){var c=a.length?t.currentTime-a.slice(-1)[0].logicalStartTime:0,s=t.currentTime+.1,l=i({segment:r,startTime:s,offset:c,audioBuffer:e});a.forEach((function(t){t.gainNode.gain.setValueAtTime(.9999,s),t.gainNode.gain.exponentialRampToValueAtTime(1e-5,s+3*d)})),a=[{node:l.node,gainNode:l.gainNode,logicalStartTime:t.currentTime-c,bufferDuration:e.duration,media:r}];var f={iteration:n.iteration,gallery:"first-floor"};u(),o=p({},f,{offset:0})}),(function(t){console.log("Decode err",t)}))}}}}(h,t,(function(t){return i({type:"playbackStatus",status:t})}));s.current=e.dispatch}}),[n.progress]);return a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"wrapper"},a.a.createElement("header",{className:"header"},a.a.createElement("button",{className:"begin",onClick:function(){h.resume().then((function(){i({type:"beginPlayback"})}))}},"Begin Playback")),"running"===n.audioContextStatus&&f.map((function(t,e){return a.a.createElement("div",{className:"iteration-box"},a.a.createElement("img",{className:"iteration \n              ".concat(t.iteration===n.playbackStatus.iteration?"playing":"","\n              ").concat(t.iteration===n.requestedIteration?"requested":"","\n              "),src:"sitting.svg",style:{gridArea:"iteration".concat(Math.floor(e/3)).concat(e%3)},key:t.iteration,onClick:function(){i({type:"requestIteration",iteration:t.iteration}),s.current({type:"change-iteration",iteration:t.iteration})}}))})),a.a.createElement("br",null),a.a.createElement("pre",null,JSON.stringify(n.playbackStatus,null,2)),a.a.createElement("footer",{className:"footer"},a.a.createElement("pre",null,o," of ",u," files loaded."," "+n.audioContextStatus,". Chazen \uff06 cetera. 2020."))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}],[[6,1,2]]]);
//# sourceMappingURL=main.1acda20f.chunk.js.map